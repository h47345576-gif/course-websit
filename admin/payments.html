<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <link rel="stylesheet" href="admin.css">
    <style>
        .payments-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .payments-section h3 {
            color: #1e1e2e;
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #6366f1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .payments-section h3 .icon {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px 20px;
            text-align: center;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card.success {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-color: #86efac;
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            border-color: #fcd34d;
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-color: #fca5a5;
        }

        .stat-card.info {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-color: #93c5fd;
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e1e2e;
            line-height: 1;
        }

        .stat-unit {
            color: #9ca3af;
            font-size: 0.85rem;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* Form Styles */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            background: #fff;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Payments Table */
        .payments-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .payments-table th,
        .payments-table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #f3f4f6;
        }

        .payments-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .payments-table tr:hover {
            background: #f9fafb;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-completed {
            background: #dcfce7;
            color: #10b981;
        }

        .status-pending {
            background: #fef3c7;
            color: #f59e0b;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #ef4444;
        }

        .btn-action {
            padding: 8px 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
            display: inline-block;
        }

        .btn-edit {
            background: #dbeafe;
            color: #2563eb;
            margin-left: 5px;
        }

        .btn-edit:hover {
            background: #bfdbfe;
            transform: scale(1.1);
        }

        .btn-delete {
            background: #fee2e2;
            color: #ef4444;
        }

        .btn-delete:hover {
            background: #fecaca;
            transform: scale(1.1);
        }

        .actions-cell {
            white-space: nowrap;
        }

        .btn-view {
            background: #dcfce7;
            color: #10b981;
        }

        .btn-view:hover {
            background: #bbf7d0;
        }

        /* Add Payment Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: flex-start;
            justify-content: center;
            overflow-y: auto;
            padding: 40px 20px;
        }

        .modal.active {
            display: flex;
        }

        body.modal-open {
            overflow: hidden;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 100%;
            max-width: 550px;
            margin: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f3f4f6;
        }

        .modal-header h2 {
            margin: 0;
            color: #1e1e2e;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #9ca3af;
        }

        .btn-close:hover {
            color: #ef4444;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
            width: 100%;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .btn-add {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .page-header h2 {
            font-size: 1.8rem;
            color: #1e1e2e;
            margin: 0;
        }

        .page-header p {
            color: #6b7280;
            font-size: 1rem;
            margin: 5px 0 0 0;
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-section .form-group {
            min-width: 150px;
        }

        .btn-filter {
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
        }

        .btn-filter:hover {
            background: #4f46e5;
        }
    </style>
</head>

<body>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span class="logo-icon">ğŸ“š</span>
            <span class="logo-text">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
        </div>
        <nav class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <span class="nav-icon">ğŸ“Š</span>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            <a href="users.html" class="nav-item">
                <span class="nav-icon">ğŸ‘¥</span>
                <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</span>
            </a>
            <a href="courses.html" class="nav-item">
                <span class="nav-icon">ğŸ“š</span>
                <span>Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</span>
            </a>
            <a href="payments.html" class="nav-item active">
                <span class="nav-icon">ğŸ’°</span>
                <span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</span>
            </a>
            <a href="settings.html" class="nav-item">
                <span class="nav-icon">âš™ï¸</span>
                <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="../index.html" class="nav-item">
                <span class="nav-icon">ğŸŒ</span>
                <span>Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
            </a>
            <button class="nav-item logout-btn" onclick="logout()">
                <span class="nav-icon">ğŸšª</span>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <header class="header">
            <button class="menu-toggle" id="menuToggle">â˜°</button>
            <h1>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h1>
            <div class="header-actions"></div>
        </header>

        <div class="dashboard">
            <div class="page-header">
                <div>
                    <h2>ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h2>
                    <p>Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¯ÙØ¹</p>
                </div>
                <button class="btn-add" onclick="openAddPaymentModal()">
                    <span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¯ÙØ¹
                </button>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card success">
                    <div class="stat-icon">âœ…</div>
                    <div class="stat-value" id="completedTotal">120,000</div>
                    <div class="stat-unit">Ù„.Ø³</div>
                    <div class="stat-label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-icon">â³</div>
                    <div class="stat-value" id="pendingTotal">75,000</div>
                    <div class="stat-unit">Ù„.Ø³</div>
                    <div class="stat-label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-icon">âŒ</div>
                    <div class="stat-value" id="cancelledTotal">100,000</div>
                    <div class="stat-unit">Ù„.Ø³</div>
                    <div class="stat-label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù„ØºÙŠØ©</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-value" id="totalPayments">5</div>
                    <div class="stat-unit">Ø¹Ù…Ù„ÙŠØ©</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="payments-section">
                <h3><span class="icon">ğŸ”</span> ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
                <div class="filter-section">
                    <div class="form-group">
                        <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <select id="filterStatus">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                            <option value="pending">Ù…Ø¹Ù„Ù‚</option>
                            <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                        <select id="filterMethod">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="sham_cash">Ø´Ø§Ù… ÙƒØ§Ø´</option>
                            <option value="mtn_cash">MTN Cash</option>
                            <option value="syriatel_cash">Syriatel Cash</option>
                            <option value="bank">Ø­ÙˆØ§Ù„Ø© Ø¨Ù†ÙƒÙŠØ©</option>
                            <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="filterFromDate">
                    </div>
                    <div class="form-group">
                        <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="filterToDate">
                    </div>
                    <button class="btn-filter" onclick="filterPayments()">ğŸ” Ø¨Ø­Ø«</button>
                </div>
            </div>

            <!-- Payments Table -->
            <div class="payments-section">
                <h3><span class="icon">ğŸ“‹</span> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
                <table class="payments-table">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„ÙƒÙˆØ±Ø³</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTableBody">
                        <!-- Payments will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Add/Edit Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <button class="btn-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="paymentForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <input type="text" name="customer_name" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙˆØ±Ø³</label>
                        <input type="text" name="course_name" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ù„.Ø³)</label>
                        <input type="number" name="amount" required placeholder="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                        <select name="payment_method" required>
                            <option value="sham_cash">Ø´Ø§Ù… ÙƒØ§Ø´</option>
                            <option value="mtn_cash">MTN Cash</option>
                            <option value="syriatel_cash">Syriatel Cash</option>
                            <option value="bank">Ø­ÙˆØ§Ù„Ø© Ø¨Ù†ÙƒÙŠØ©</option>
                            <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <select name="status" required>
                            <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                            <option value="pending">Ù…Ø¹Ù„Ù‚</option>
                            <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" name="date" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea name="notes" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn-primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
            </form>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/api.js"></script>
    <script src="admin.js"></script>
    <script>
        let payments = [];

        // Initialize with sample data or load from localStorage
        function initPayments() {
            const saved = localStorage.getItem('platform_payments');
            if (saved) {
                payments = JSON.parse(saved);
            } else {
                // Sample data
                payments = [
                    { id: 1, customer_name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', course_name: 'Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø¨Ù„ØºØ© Python', amount: 50000, payment_method: 'sham_cash', status: 'completed', date: '2026-01-28', notes: '' },
                    { id: 2, customer_name: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', course_name: 'ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', amount: 75000, payment_method: 'mtn_cash', status: 'pending', date: '2026-01-27', notes: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯' },
                    { id: 3, customer_name: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', course_name: 'ØªØ·ÙˆÙŠØ± ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„', amount: 25000, payment_method: 'syriatel_cash', status: 'completed', date: '2026-01-26', notes: '' },
                    { id: 4, customer_name: 'ÙØ§Ø·Ù…Ø© Ø®Ø§Ù„Ø¯', course_name: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', amount: 100000, payment_method: 'bank', status: 'cancelled', date: '2026-01-25', notes: 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨' },
                    { id: 5, customer_name: 'Ø¹Ù…Ø± Ø­Ø³Ù†', course_name: 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ', amount: 45000, payment_method: 'cash', status: 'completed', date: '2026-01-24', notes: '' }
                ];
                savePayments();
            }
            renderPayments();
            updateStats();
        }

        function savePayments() {
            localStorage.setItem('platform_payments', JSON.stringify(payments));
        }

        function renderPayments(filteredPayments = null) {
            const data = filteredPayments || payments;
            const tbody = document.getElementById('paymentsTableBody');

            const methodLabels = {
                'sham_cash': 'Ø´Ø§Ù… ÙƒØ§Ø´',
                'mtn_cash': 'MTN Cash',
                'syriatel_cash': 'Syriatel Cash',
                'bank': 'Ø­ÙˆØ§Ù„Ø© Ø¨Ù†ÙƒÙŠØ©',
                'cash': 'Ù†Ù‚Ø¯ÙŠ'
            };

            const statusLabels = {
                'completed': { text: 'Ù…ÙƒØªÙ…Ù„', class: 'status-completed' },
                'pending': { text: 'Ù…Ø¹Ù„Ù‚', class: 'status-pending' },
                'cancelled': { text: 'Ù…Ù„ØºÙŠ', class: 'status-cancelled' }
            };

            tbody.innerHTML = data.map(p => `
                <tr>
                    <td>#${String(p.id).padStart(3, '0')}</td>
                    <td>${p.customer_name}</td>
                    <td>${p.course_name}</td>
                    <td>${p.amount.toLocaleString()} Ù„.Ø³</td>
                    <td>${methodLabels[p.payment_method] || p.payment_method}</td>
                    <td><span class="status-badge ${statusLabels[p.status]?.class}">${statusLabels[p.status]?.text}</span></td>
                    <td>${p.date}</td>
                    <td class="actions-cell">
                        <button class="btn-action btn-edit" onclick="editPayment(${p.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                        <button class="btn-action btn-delete" onclick="deletePayment(${p.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateStats() {
            const completed = payments.filter(p => p.status === 'completed').reduce((sum, p) => sum + p.amount, 0);
            const pending = payments.filter(p => p.status === 'pending').reduce((sum, p) => sum + p.amount, 0);
            const cancelled = payments.filter(p => p.status === 'cancelled').reduce((sum, p) => sum + p.amount, 0);

            document.getElementById('completedTotal').textContent = completed.toLocaleString();
            document.getElementById('pendingTotal').textContent = pending.toLocaleString();
            document.getElementById('cancelledTotal').textContent = cancelled.toLocaleString();
            document.getElementById('totalPayments').textContent = payments.length;
        }

        function openAddPaymentModal() {
            document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯Ø©';
            document.getElementById('paymentForm').reset();
            document.getElementById('paymentForm').dataset.paymentId = '';
            document.getElementById('paymentForm').querySelector('[name="date"]').valueAsDate = new Date();
            document.getElementById('paymentModal').classList.add('active');
            document.body.classList.add('modal-open');
        }

        function closeModal() {
            document.getElementById('paymentModal').classList.remove('active');
            document.body.classList.remove('modal-open');
        }

        function editPayment(id) {
            const payment = payments.find(p => p.id === id);
            if (payment) {
                document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹';
                const form = document.getElementById('paymentForm');
                form.dataset.paymentId = id;
                form.customer_name.value = payment.customer_name;
                form.course_name.value = payment.course_name;
                form.amount.value = payment.amount;
                form.payment_method.value = payment.payment_method;
                form.status.value = payment.status;
                form.date.value = payment.date;
                form.notes.value = payment.notes || '';
                document.getElementById('paymentModal').classList.add('active');
                document.body.classList.add('modal-open');
            }
        }

        function deletePayment(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')) {
                payments = payments.filter(p => p.id !== id);
                savePayments();
                renderPayments();
                updateStats();
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
            }
        }

        function filterPayments() {
            const status = document.getElementById('filterStatus').value;
            const method = document.getElementById('filterMethod').value;
            const fromDate = document.getElementById('filterFromDate').value;
            const toDate = document.getElementById('filterToDate').value;

            let filtered = [...payments];

            if (status) {
                filtered = filtered.filter(p => p.status === status);
            }
            if (method) {
                filtered = filtered.filter(p => p.payment_method === method);
            }
            if (fromDate) {
                filtered = filtered.filter(p => p.date >= fromDate);
            }
            if (toDate) {
                filtered = filtered.filter(p => p.date <= toDate);
            }

            renderPayments(filtered);
        }

        // Form Submit
        document.getElementById('paymentForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const paymentId = this.dataset.paymentId;
            const paymentData = {
                customer_name: this.customer_name.value,
                course_name: this.course_name.value,
                amount: parseInt(this.amount.value),
                payment_method: this.payment_method.value,
                status: this.status.value,
                date: this.date.value,
                notes: this.notes.value
            };

            if (paymentId) {
                // Edit existing
                const index = payments.findIndex(p => p.id === parseInt(paymentId));
                if (index !== -1) {
                    payments[index] = { ...payments[index], ...paymentData };
                }
            } else {
                // Add new
                const newId = payments.length > 0 ? Math.max(...payments.map(p => p.id)) + 1 : 1;
                payments.push({ id: newId, ...paymentData });
            }

            savePayments();
            renderPayments();
            updateStats();
            closeModal();
            alert(paymentId ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!' : 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
        });

        // Initialize
        initPayments();
    </script>
</body>

</html>